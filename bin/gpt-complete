#!/bin/bash
set -e
secret_key=$(cat ~/.config/openaiapirc | sed -n -e 's/^secret_key *= *\(.*\)$/\1/p')
tempfile=$(mktemp)
cat>$tempfile
cat $tempfile
cat $tempfile | \
  jq -sR '{
  "model": "text-davinci-003",
  "prompt": .,
  "max_tokens": 2048,
  "temperature": 0
  }'| \
  curl -s https://api.openai.com/v1/completions \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer ${secret_key}" \
    -d @- |\
  jq -r '.choices[0].text'
rm $tempfile
