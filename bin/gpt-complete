#!/bin/bash
#OPENAI_API_KEY=$(cat ~/.config/openaiapirc | sed -n -e 's/^secret_key *= *\(.*\)$/\1/p') ~/.normen/bin/codex-universal.py $*
set -e
secret_key=$(cat ~/.config/openaiapirc | sed -n -e 's/^secret_key *= *\(.*\)$/\1/p')
tempfile=$(mktemp)
cat>$tempfile
cat $tempfile
cat $tempfile | \
  jq -sR '{ "prompt": ., "max_tokens": 2048 }'| \
  curl -s https://api.openai.com/v1/engines/text-davinci-003/completions \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer ${secret_key}" \
    -d @- |\
  jq -r '.choices[0].text'
rm $tempfile
